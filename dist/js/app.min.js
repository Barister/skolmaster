(()=>{"use strict";var t,e;({init:function(){document.addEventListener("DOMContentLoaded",this.onDomContentLoaded.bind(this))},onDomContentLoaded:function(){this.cacheDom(),this.bindEvents(),this.hideEmailField()},cacheDom:function(){this.buttons=document.querySelectorAll(".btn"),this.modalForm=document.querySelector(".modal-form"),this.form=document.querySelector("#form"),this.body=document.querySelector("body"),this.formSubmitResult=this.modalForm.querySelector(".modal-form__result"),this.email=this.modalForm.querySelector(".modal-form__email"),this.phonePattern=/^(\+7|7|8|9)\d{9,}$/},bindEvents:function(){this.buttons.forEach((t=>{t.addEventListener("click",this.onClick.bind(this))}))},hideEmailField:function(){this.email&&this.updateStyles(this.email,{display:"none",visibility:"hidden"})},onClick:function(t){t.stopPropagation(),this.toggleModal(!0),document.addEventListener("click",this.outerClickListener.bind(this)),this.form.addEventListener("submit",this.formValidate.bind(this))},outerClickListener:function(t){t.target.closest("#form")&&!t.target.closest(".modal-form__close")||this.hidePopup()},hidePopup:function(){this.toggleModal(!1),this.updateResult("")},toggleModal:function(t){this.modalForm.classList.toggle("active",t),this.form.classList.toggle("active",t),this.body.classList.toggle("scroll-lock",t),t||(document.removeEventListener("click",this.outerClickListener.bind(this)),this.form.removeEventListener("submit",this.formValidate.bind(this)))},updateResult:function(t,e=!1){this.formSubmitResult.textContent=t,this.formSubmitResult.classList.toggle("err",e),this.formSubmitResult.classList.toggle("ok",!e&&""!==t)},formValidate:function(t){t.preventDefault();const e=this.form.querySelector("#email"),i=this.form.querySelector("#checkbox"),o=this.form.querySelector("#phone");this.phonePattern.test(o.value)&&i&&!e.value?this.submitForm(t):this.updateResult("Проверьте номер телефона на ошибки!",!0)},submitForm:async function(t){try{const e=await fetch(t.target.action,{method:"POST",body:new FormData(t.target)});if(!e.ok)throw`Error accessing the server: ${e.status}`;const i=e.headers.get("content-type");if(!i||!i.includes("application/json"))throw"Processing error. The response is not JSON";const o=await e.json();"success"===o.result?(this.updateResult("Заявка успешна отправлена."),setTimeout(this.hidePopup.bind(this),3e3),this.form.reset()):this.updateResult(`Ошибка отправки заявки 1. ${o.info}`,!0)}catch(t){this.updateResult(`Ошибка отправки заявки 2. ${t}`,!0)}},updateStyles:function(t,e){Object.assign(t.style,e)}}).init(),t=function(t){1==t?document.querySelector("body").classList.add("webp"):document.querySelector("body").classList.add("no-webp")},(e=new Image).onload=e.onerror=function(){t(2==e.height)},e.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"})();